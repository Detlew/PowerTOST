---
title: "README"
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## PowerTOST

The package contains functions to calculate power and estimate sample size for various study designs used in (not only bio-) equivalence studies.

### Supported designs

```{r, echo = FALSE}
designs <- PowerTOST::known.designs()
print(designs[, c(2, 9, 3)], row.names = FALSE)
```

### Purpose

For various methods power can be *calculated* based on

  - nominal *α*, coefficient of variation (*CV*), deviation of test from reference (*θ*<sub>0</sub>), acceptance limits {*θ*<sub>1</sub>, *θ*<sub>2</sub>}, sample size (*n*), and design.

For all methods the sample size can be *estimated* based on

  - nominal *α*, coefficient of variation (*CV*), deviation of test from reference (*θ*<sub>0</sub>), acceptance limits {*θ*<sub>1</sub>, *θ*<sub>2</sub>}, target power, and design.

### Supported
#### Power and sample size
  - Average bioequivalence (with arbitrary *fixed* limits).
  - Two simultaneous TOST procedures.
  - Non-inferiority *t*-test.
  - Ratio of two means with normally distributed data on the original scale based on Fieller’s (‘fiducial’) confidence interval.
  - ‘Expected’ power in case of uncertain (estimated) variability and/or uncertain *θ*<sub>0</sub>.
  - Reference-scaled bioequivalence based on simulations.  
    EMA: Average Bioequivalence with Expanding Limits (ABEL).  
    FDA: Reference-scaled Average Bioequivalence (RSABE) for Highly Variable Drugs / Drug Products and Narrow Therapeutic Index Drugs (NTIDs).
  - Iteratively adjust *α* to control the type I error in ABEL and RSABE.
  - Dose-proportionality using the power model.

#### Methods
  - Exact
    - Owen’s Q.
    - Direct integration of the bivariate non-central *t*-distribution.
  - Approximations
    - Non-central *t*-distribution.
    - ‘Shifted’ central *t*-distribution.

#### Helpers
  - Calculate *CV* from *MSE* or *SE* (and vice versa).
  - Calculate *CV* from given confidence interval.
  - Calculate *CV<sub>wR</sub>* from the upper expanded limit of an ABEL study.
  - Confidence interval of *CV*.
  - Pool *CV* from several studies.
  - Confidence interval for given *α*, *CV*, point estimate, sample size, and design.
  - Calculate *CV<sub>wT</sub>* and *CV<sub>wR</sub>* from a (pooled) *CV<sub>w</sub>* assuming a ratio of intra-subject variances.
  - *p*-values of the TOST procedure.
  - Analysis tool for exploration/visualization of the impact of expected values (*CV*, *θ*<sub>0</sub>, reduced sample size due to drop-outs) on power of BE decision.
  - Construct design matrices of incomplete block designs.

### Examples

  1. Power of a paralled design (group sizes 75 and 70), total *CV* 0.36, *θ*<sub>0</sub> 0.925. The defaults of *α* (0.05) and {*θ*<sub>1</sub>, *θ*<sub>2</sub>} (0.80, 1.25), and the exact method are automatically employed.
```{r}
PowerTOST::power.TOST(CV = 0.36, theta0 = 0.925,
                      n = c(75, 70), design = "parallel")
```
  2. Sample size for a 2×2×2 crossover study, assumed intra-subject *CV* 0.20, and desired power 0.80. The defaults of *α* (0.05), *θ*<sub>0</sub> (0.95), {*θ*<sub>1</sub>, *θ*<sub>2</sub>} (0.80, 1.25), targetpower (0.80), design ("2x2"), and the exact method are automatically employed.
```{r}
PowerTOST::sampleN.TOST(CV = 0.20)
```

  3. As above but intra-subject *CV* 0.17. Explore sample sizes and achieved power for the supported methods (the 1<sup>st</sup> one is the default).

```{r}
expl <- data.frame(method = c("owenq", "mvt", "noncentral", "shifted"),
                   n = NA, power = NA, seconds = NA)
for (i in 1:nrow(expl)) {
  start <- proc.time()[[3]]
  expl[i, 2:3] <- PowerTOST::sampleN.TOST(CV = 0.17,
                                          method = expl$method[i],
                                          print = FALSE)[7:8]
  expl[i, 4] <- proc.time()[[3]] - start
}
print(expl, digits = 6, row.names = FALSE)
```

  - The 2<sup>nd</sup> exact method is substantially slower than the 1<sup>st</sup>. The approximation based on the noncentral *t*-distribution is -- sometimes -- slightly slower but matches the 1<sup>st</sup> exact method closely. However, it is up to 100times faster in replicate designs and therefore, the default in methods for reference-scaling. The approximation based on the shifted central *t*-distribution might estimate a sample size higher than necessary. Hence, it should be used only for comparative purposes.
  
  4. Sample size for a study intended for the EMA’s ABEL assuming homoscedasticity (*CV<sub>wT</sub>* = *CV<sub>wR</sub>* = 0.45). The defaults of *α* (0.05), *θ*<sub>0</sub> (0.90 for HVD(P)s), targetpower (0.80), the partial replicate design (TRR|RTR|RRT), and the approximation based on the non-central *t*-distribution method are automatically employed. The expanded limits [*L*, *U*] are based on *CV<sub>wR</sub>*. 100,000 studies are simulated by default; details of the regulatory settings and the sample size search shown.

```{r}
PowerTOST::sampleN.scABEL(CV = 0.45, details = TRUE)
```

  5. Sample size for a four-period full replicate study (TRTR|RTRT) intended for the FDA’s RSABE assuming heteroscedasticity (*CV<sub>wT</sub>* 0.40, *CV<sub>wR</sub>* 0.50). The defaults of *α* (0.05), *θ*<sub>0</sub> (0.90), targetpower (0.80), and the approximation based on the non-central *t*-distribution method are automatically employed. Scaling is based on *CV<sub>wR</sub>*. 100,000 studies are simulated by default; details of the sample size search suppressed.

```{r}
PowerTOST::sampleN.RSABE(CV = c(0.40, 0.50), design = "2x2x4",
                         details = FALSE)
```

  6. Sample size for a study intended for the FDA’s RSABE for NTIDs assuming heteroscedasticity (*CV<sub>wT</sub>* 0.15, *CV<sub>wR</sub>* 0.10). The defaults of *α* (0.05), *θ*<sub>0</sub> (0.975 for NTIDs), targetpower (0.80), TRTR|RTRT design, and the approximation based on the non-central *t*-distribution method are automatically employed. Scaling is based on *CV<sub>wR</sub>*. 100,000 studies are simulated by default. Assess which of the three conditions (scaled, ABE, *s<sub>wT</sub>*/*s<sub>wR</sub>* ratio) drives the sample size.

```{r}
CV <- c(0.15, 0.10)
n  <- PowerTOST::sampleN.NTIDFDA(CV = CV, details = FALSE)[["Sample size"]]
suppressMessages(PowerTOST::power.NTIDFDA(CV = CV, n = n, details = TRUE))
```

   - Here the *s<sub>wT</sub>*/*s<sub>wR</sub>* component has the lowest power and hence, drives the sample size.  
     Compare that with homoscedasticity (*CV<sub>wT</sub>* = *CV<sub>wR</sub>* = 0.10):
    
```{r}
CV <- 0.10
n  <- PowerTOST::sampleN.NTIDFDA(CV = CV, details = FALSE)[["Sample size"]]
suppressMessages(PowerTOST::power.NTIDFDA(CV = CV, n = n, details = TRUE))
```    

   - Now the scaled ABE component has the lowest power and drives the -- much lower -- sample size.  

  7. Sample size for a dose-proportionality study assessed by the power model, doses 1, 2, 8 units, assumed *CV* 0.20, slope 1, target power 0.90. The defaults of *α* (0.05), {*θ*<sub>1</sub>, *θ*<sub>2</sub>} (0.80, 1.25), and a crossover design are automatically employed.

```{r}
PowerTOST::sampleN.dp(CV = 0.20, doses = c(1, 2, 8),
                      beta0 = 1, targetpower = 0.90)
```

### Installation
You can install the released version of PowerTOST from [CRAN](https://CRAN.R-project.org) with:
```{r}
package <- "PowerTOST"
inst    <- package %in% installed.packages()
if (length(package[!inst]) > 0) install.packages(package[!inst])
```
And the development version from [GitHub](https://github.com/) with:
``` r
# install.packages("devtools")
devtools::install_github("Detlew/PowerTOST")
```
